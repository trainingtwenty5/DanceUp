<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Drzewko Umiejętności Breaking - Widok Drzewa</title>
  <style>
  
        :root {
            --bg: ; 
            --panel: #151936; 
            --text: #f3f5ff; 
            --accent: #7c9dff; 
            --accent-2: #6df0c2; 
            --locked: bule; 
            --unlocked: blue;
            --connector: #4a5085;
            
            /* Zaktualizowane kolory */
			/* Zaktualizowane kolory gradientowe */
			--level1: #e6af89; /* Żółty gradient, energetyczny */
			--level2: green; /* Zielony gradient, świeży i nowoczesny */
			--level3: blue;           /* Subtelny szary → fiolet, elegancki *
						
            /* Nowe zmienne dla lepszej konsystencji */
            --radius-sm: 4px;
            --radius-md: 8px;
            --radius-lg: 12px;
            --radius-xl: 16px;
            --shadow-sm: 0 1px 2px rgba(0, 0, 0, 0.05);
            --shadow-md: 0 4px 6px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 10px 15px rgba(0, 0, 0, 0.2);
            --transition: all 0.3s ease;
        }

        * { 
            box-sizing: border-box; 
            margin: 0; 
            padding: 0; 
        }

        body { 
            font-family: 'Inter', 'SF Pro Text', Roboto, Arial, sans-serif; 
            background: var(--bg); 
            color: var(--text);
            overflow-x: hidden;
            padding: 20px;
            min-height: 100vh;
            line-height: 1.6;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
        }

        h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            background: linear-gradient(90deg, var(--accent), var(--accent-2));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-weight: 800;
        }

        .subtitle {
            color: #8a90b0;
            font-size: 1.1rem;
            max-width: 600px;
            margin: 0 auto;
        }

        /* Ekran logowania */
        .auth-container {
            max-width: 400px;
            margin: 100px auto;
            padding: 30px;
            background: var(--panel);
            border-radius: var(--radius-xl);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: var(--shadow-lg);
            backdrop-filter: blur(10px);
        }

        .auth-container h2 {
            text-align: center;
            margin-bottom: 20px;
            font-weight: 700;
        }

        .auth-input {
            width: 100%;
            padding: 12px 14px;
            margin-bottom: 15px;
            border-radius: var(--radius-lg);
            border: 1px solid rgba(255, 255, 255, 0.1);
            background: rgba(0, 0, 0, 0.2);
            color: var(--text);
            font-size: 1rem;
            transition: var(--transition);
        }

        .auth-input:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 2px rgba(124, 157, 255, 0.3);
        }

        .auth-button {
            width: 100%;
            padding: 12px;
            border-radius: var(--radius-lg);
            border: none;
            background: linear-gradient(90deg, var(--accent), var(--accent-2));
            color: var(--bg);
            font-weight: 600;
            cursor: pointer;
            margin-bottom: 10px;
            transition: var(--transition);
        }

        .auth-button:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .auth-switch {
            text-align: center;
            color: #8a90b0;
            margin-top: 20px;
            cursor: pointer;
            transition: var(--transition);
        }

        .auth-switch:hover {
            color: var(--accent);
        }

        .error-message {
            color: #ff6b6b;
            text-align: center;
            margin: 10px 0;
            font-size: 14px;
        }

        /* Główna aplikacja */
        .app-container {
            display: none;
        }

        /* Drzewko umiejętności */
        .skill-tree {
            position: relative;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 1000px;
            padding: 2rem 0;
        }

        /* Centralna oś drzewka */
        .tree-axis {
            position: absolute;
            top: 0;
            bottom: 0;
            width: 6px;
            background: linear-gradient(to bottom, var(--accent), var(--accent-2));
            border-radius: 3px;
            z-index: 1;
        }

        /* Poziomy drzewka */
        .tree-level {
            position: relative;
            width: 100%;
            display: flex;
            justify-content: center;
            margin: 120px 0;
            z-index: 2;
            gap: 40px;
        }

        /* Główny skill na osi */
        .main-skill {
            position: relative;
            padding: 18px 24px;
            border-radius: var(--radius-xl);
            text-align: center;
            min-width: 180px;
            z-index: 3;
            box-shadow: var(--shadow-lg);
            cursor: pointer;
            transition: var(--transition);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .main-skill:hover {
            transform: translateY(-4px) scale(1.02);
            box-shadow: var(--shadow-lg);
        }

.main-skill.level1 { 
    background: linear-gradient(135deg, #FFD700, #FFA500); /* Złoty → pomarańczowy gradient, energetyczny i ciepły */
    border: 2px solid rgba(255, 215, 0, 0.3); 
}

.main-skill.level2 { 
    background: linear-gradient(135deg, #00E676, #1DE9B6); /* Jasny, świeży zielony → turkusowy, nowoczesny */
    border: 2px solid rgba(0, 230, 118, 0.3); 
}

.main-skill.level3 { 
    background: linear-gradient(135deg, #8E8E8E, #B39DDB); /* Szary → delikatny fiolet, elegancki i subtelny */
    border: 2px solid rgba(142, 142, 142, 0.3); 
}

.main-skill.locked { 
    background: #4a5085; 
    border-color: #4a5085; 
    opacity: 0.7; 
}

        .skill-name {
            font-weight: 700;
            font-size: 1.1rem;
            margin-bottom: 5px;
        }

        .skill-level {
            font-size: 0.9rem;
            opacity: 0.9;
        }

        /* Gałęzie (lewa i prawa) */
        .branch {
            position: absolute;
            top: 50%;
            display: flex;
            align-items: center;
            flex-direction: column;
            gap: 12px;
        }

        .branch-left { right: calc(50% + 120px); flex-direction: column-reverse; }
        .branch-right { left: calc(50% + 120px); }

        /* Łącznik gałęzi */
        .branch-connector {
            width: 80px;
            height: 2px;
            background: var(--connector);
            position: relative;
        }

        .branch-left .branch-connector::after,
        .branch-right .branch-connector::after {
            content: '';
            position: absolute;
            width: 12px;
            height: 12px;
            top: -5px;
            border: 2px solid var(--connector);
            border-radius: 50%;
            background: var(--panel);
        }

        .branch-left .branch-connector::after { left: 0; }
        .branch-right .branch-connector::after { right: 0; }

        /* Skill na gałęzi */
        .branch-skill {
            padding: 14px 20px;
            border-radius: var(--radius-xl);
            min-width: 160px;
            text-align: center;
            cursor: pointer;
            box-shadow: var(--shadow-md);
            transition: var(--transition);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .branch-skill:hover {
            transform: translateY(-3px) scale(1.02);
            box-shadow: var(--shadow-lg);
        }

        .branch-skill.level1 { 
            background: linear-gradient(135deg, var(--level1), #FFB74D); 
            border: 2px solid rgba(255, 209, 102, 0.3);
        }
        .branch-skill.level2 { 
            background: linear-gradient(135deg, var(--level2), #05C191); 
            border: 2px solid rgba(6, 214, 160, 0.3);
        }
        .branch-skill.level3 { 
            background: linear-gradient(135deg, var(--level3), #7A6E7A); 
            border: 2px solid rgba(154, 140, 152, 0.3);
        }
        .branch-skill.locked { 
            background: var(--locked); 
            border-color: #4a5085; 
            opacity: 0.7; 
        }

        /* Licznik umiejętności w gałęzi */
        .branch-counter {
            position: absolute;
            top: -20px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--panel);
            padding: 3px 8px;
            border-radius: var(--radius-lg);
            font-size: 0.8rem;
            border: 1px solid var(--connector);
            backdrop-filter: blur(5px);
        }

        /* Linie łączące */
        .connector {
            position: absolute;
            background: var(--connector);
            z-index: 1;
        }

        .vertical-connector {
            width: 2px;
            height: 80px;
            top: -80px;
            left: 50%;
            transform: translateX(-50%);
        }

        /* Panel użytkownika */
        .user-panel {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(21, 25, 54, 0.8);
            padding: 15px;
            border-radius: var(--radius-lg);
            border: 1px solid rgba(255, 255, 255, 0.1);
            z-index: 10;
            display: flex;
            flex-direction: column;
            gap: 10px;
            min-width: 200px;
            backdrop-filter: blur(10px);
            box-shadow: var(--shadow-md);
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--accent), var(--accent-2));
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            box-shadow: var(--shadow-sm);
        }

        .user-name { font-weight: 600; }

        .progress-bar {
            height: 6px;
            background: var(--locked);
            border-radius: 3px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--accent), var(--accent-2));
            border-radius: 3px;
            transition: width 0.5s ease;
        }

        .progress-text {
            font-size: 0.8rem;
            text-align: center;
            opacity: 0.8;
        }

        .logout-btn {
            padding: 8px;
            background: #ff6b6b;
            color: white;
            border: none;
            border-radius: var(--radius-md);
            cursor: pointer;
            font-weight: 600;
            transition: var(--transition);
        }

        .logout-btn:hover {
            background: #ff5252;
            transform: translateY(-1px);
        }

        /* Responsywność */
        @media (max-width: 1200px) {
            .branch-left { right: calc(50% + 100px); }
            .branch-right { left: calc(50% + 100px); }
        }

        @media (max-width: 900px) {
            .branch { 
                flex-direction: column !important; 
                position: static; 
                margin: 20px 0; 
                justify-content: center; 
            }
            .branch-connector { 
                width: 2px; 
                height: 40px; 
                margin: 10px 0; 
            }
            .branch-left .branch-connector::after,
            .branch-right .branch-connector::after { 
                left: 50%; 
                transform: translateX(-50%) rotate(0); 
            }
            .tree-level { 
                flex-direction: column; 
                align-items: center; 
                gap: 20px; 
            }
            
            .user-panel {
                position: relative;
                top: unset;
                right: unset;
                margin-bottom: 20px;
                width: 100%;
                max-width: 400px;
                margin-left: auto;
                margin-right: auto;
            }
        }

        @media (max-width: 640px) {
            body {
                padding: 1rem;
            }
            
            .auth-container {
                margin: 50px auto;
                padding: 20px;
            }
            
            .skill-tree {
                padding: 1rem 0;
            }
            
            .main-skill, .branch-skill {
                min-width: 140px;
                padding: 14px 16px;
            }
        }
  </style>
</head>
<body>
  <!-- Ekran logowania -->
  <div id="auth-container" class="auth-container">
    <h2>Logowanie do Drzewka Umiejętności</h2>
    <div id="login-form">
      <input type="email" id="login-email" class="auth-input" placeholder="Adres email">
      <input type="password" id="login-password" class="auth-input" placeholder="Hasło">
      <div id="login-error" class="error-message"></div>
      <button id="login-btn" class="auth-button">Zaloguj się</button>
      <div class="auth-switch" id="show-register">Nie masz konta? Zarejestruj się</div>
    </div>
    
    <div id="register-form" style="display: none;">
      <input type="text" id="register-name" class="auth-input" placeholder="Imię i nazwisko">
      <input type="email" id="register-email" class="auth-input" placeholder="Adres email">
      <input type="password" id="register-password" class="auth-input" placeholder="Hasło (min. 6 znaków)">
      <div id="register-error" class="error-message"></div>
      <button id="register-btn" class="auth-button">Zarejestruj się</button>
      <div class="auth-switch" id="show-login">Masz już konto? Zaloguj się</div>
    </div>
  </div>

  <!-- Główna aplikacja -->
  <div id="app-container" class="app-container">
    <div class="container">
      <header>
        <h1>Drzewko Umiejętności Breaking</h1>
        <p class="subtitle">Śledź swoje postępy w nauce breakdance</p>
      </header>
      
      <div class="skill-tree" id="skillTree">
        <!-- Drzewko będzie generowane dynamicznie -->
      </div>
    </div>
    
    <div class="user-panel">
      <div class="user-info">
        <div class="user-avatar" id="userAvatar">U</div>
        <div class="user-name" id="userName">Użytkownik</div>
      </div>
      <div class="progress-bar">
        <div class="progress-fill" id="progressFill" style="width: 0%"></div>
      </div>
      <div class="progress-text" id="progressText">0/25 umiejętności</div>
      <button class="logout-btn" id="logoutBtn">Wyloguj</button>
    </div>
  </div>

  <!-- Firebase SDK -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-app.js";
    import { 
      getFirestore, 
      collection, 
      getDocs, 
      doc, 
      getDoc, 
      setDoc,
      updateDoc 
    } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-firestore.js";
    import { 
      getAuth, 
      createUserWithEmailAndPassword, 
      signInWithEmailAndPassword, 
      signOut, 
      onAuthStateChanged 
    } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-auth.js";

    const firebaseConfig = {
      apiKey: "AIzaSyBdhMIiqetOfDGP85ERxtgwn3AXR50pBcE",
      authDomain: "base-468e0.firebaseapp.com",
      projectId: "base-468e0",
      storageBucket: "base-468e0.appspot.com",
      messagingSenderId: "829161895559",
      appId: "1:829161895559:web:d832541aac05b35847ea22"
    };
    
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const auth = getAuth(app);

    // Struktura drzewka umiejętności
        const SKILL_TREE = [
      {
        id: "toprock",
        name: "Toprock",
        desc: "Podstawowe kroki wykonywane na stojąco",
        level: "Poziom podstawowy",
        branches: [
          {
            direction: "left",
            skills: [
              { id: "basic-toprock", name: "Basic Toprock", level: "Poziom 1" },
              { id: "indian-step", name: "Indian Step", level: "Poziom 1", req: ["basic-toprock"] },
              { id: "side-step", name: "Side Step", level: "Poziom 2", req: ["indian-step"] },
              { id: "crossover-step", name: "Crossover Step", level: "Poziom 2", req: ["side-step"] },
              { id: "advanced-toprock", name: "Zaawansowane Toprock", level: "Poziom 3", req: ["crossover-step"] }
            ]
          }
        ]
      },
      {
        id: "footwork",
        name: "Footwork",
        desc: "Ruchy wykonywane blisko ziemi",
        level: "Poziom średniozaawansowany",
        branches: [
          {
            direction: "right",
            skills: [
              { id: "basic-6step", name: "6-step", level: "Poziom 1" },
              { id: "cc", name: "CC (Kick-outs)", level: "Poziom 1", req: ["basic-6step"] },
              { id: "3step", name: "3-step", level: "Poziom 2", req: ["basic-6step"] },
              { id: "coffee-grinder", name: "Coffee Grinder", level: "Poziom 2", req: ["cc"] },
              { id: "footwork-combos", name: "Kombinacje", level: "Poziom 3", req: ["3step","coffee-grinder"] }
            ]
          }
        ]
      },
      {
        id: "freezes",
        name: "Freezy",
        desc: "Pozycje zatrzymania w tańcu",
        level: "Poziom zaawansowany",
        branches: [
          {
            direction: "left",
            skills: [
              { id: "baby-freeze", name: "Baby Freeze", level: "Poziom 1" },
              { id: "chair-freeze", name: "Chair Freeze", level: "Poziom 1", req: ["baby-freeze"] },
              { id: "airchair", name: "Airchair", level: "Poziom 2", req: ["chair-freeze"] },
              { id: "handstand-freeze", name: "Handstand Freeze", level: "Poziom 2", req: ["baby-freeze"] },
              { id: "combo-freezes", name: "Kombinacje Freezów", level: "Poziom 3", req: ["airchair","handstand-freeze"] }
            ]
          }
        ]
      },
      {
        id: "powermoves",
        name: "Powermoves",
        desc: "Dynamiczne ruchy wymagające siły",
        level: "Poziom ekspert",
        branches: [
          {
            direction: "left",
            skills: [
              { id: "backspin", name: "Backspin", level: "Poziom 1" },
              { id: "windmill", name: "Windmill", level: "Poziom 1", req: ["backspin"] }
            ]
          },
          {
            direction: "right",
            skills: [
              { id: "flare", name: "Flare", level: "Poziom 2", req: ["windmill"] },
              { id: "headspin", name: "Headspin", level: "Poziom 2", req: ["windmill"] },
              { id: "airflare", name: "Airflare", level: "Poziom 3", req: ["flare","headspin"] }
            ]
          }
        ]
      },
      {
        id: "style",
        name: "Styl i muzykalność",
        desc: "Rozwijanie własnego stylu",
        level: "Poziom mistrzowski",
        branches: [
          {
            direction: "left",
            skills: [
              { id: "rhythm", name: "Czucie rytmu", level: "Poziom 1" },
              { id: "musicality", name: "Muzykalność", level: "Poziom 2", req: ["rhythm"] }
            ]
          },
          {
            direction: "right",
            skills: [
              { id: "transitions", name: "Płynne przejścia", level: "Poziom 2", req: ["musicality"] },
              { id: "personal-style", name: "Własny styl", level: "Poziom 3", req: ["transitions"] }
            ]
          }
        ]
      }
    ];

    // Zmienne globalne
    let userSkills = {};
    let currentUserId = null;

    // Referencje do elementów DOM
    const authContainer = document.getElementById('auth-container');
    const appContainer = document.getElementById('app-container');
    const loginForm = document.getElementById('login-form');
    const registerForm = document.getElementById('register-form');
    const loginError = document.getElementById('login-error');
    const registerError = document.getElementById('register-error');
    const userAvatar = document.getElementById('userAvatar');
    const userName = document.getElementById('userName');
    const logoutBtn = document.getElementById('logoutBtn');
    const skillTree = document.getElementById('skillTree');

    // Przełączanie między formularzami
    document.getElementById('show-register').addEventListener('click', () => {
      loginForm.style.display = 'none';
      registerForm.style.display = 'block';
      registerError.textContent = '';
    });

    document.getElementById('show-login').addEventListener('click', () => {
      registerForm.style.display = 'none';
      loginForm.style.display = 'block';
      loginError.textContent = '';
    });

    // Logowanie
    document.getElementById('login-btn').addEventListener('click', async () => {
      const email = document.getElementById('login-email').value;
      const password = document.getElementById('login-password').value;
      
      try {
        await signInWithEmailAndPassword(auth, email, password);
        loginError.textContent = '';
      } catch (error) {
        console.error('Błąd logowania:', error);
        loginError.textContent = getAuthErrorMessage(error.code);
      }
    });

    // Rejestracja
    document.getElementById('register-btn').addEventListener('click', async () => {
      const name = document.getElementById('register-name').value;
      const email = document.getElementById('register-email').value;
      const password = document.getElementById('register-password').value;
      
      if (!name) {
        registerError.textContent = 'Podaj imię i nazwisko';
        return;
      }
      
      try {
        const userCredential = await createUserWithEmailAndPassword(auth, email, password);
        const user = userCredential.user;
        
        // Utwórz dokument użytkownika w Firestore
        await setDoc(doc(db, "users", user.uid), {
          name: name,
          email: email,
          role: "user", // Domyślnie ustawiamy rolę "user"
          skills: {},
          createdAt: new Date()
        });
        
        registerError.textContent = '';
      } catch (error) {
        console.error('Błąd rejestracji:', error);
        registerError.textContent = getAuthErrorMessage(error.code);
      }
    });

    // Wylogowanie
    logoutBtn.addEventListener('click', async () => {
      try {
        await signOut(auth);
      } catch (error) {
        console.error('Błąd wylogowania:', error);
      }
    });

    // Obserwuj stan autentykacji
    onAuthStateChanged(auth, async (user) => {
      if (user) {
        // Użytkownik zalogowany
        currentUserId = user.uid;
        authContainer.style.display = 'none';
        appContainer.style.display = 'block';
        
        // Pobierz dane użytkownika
        const userDoc = await getDoc(doc(db, "users", user.uid));
        let userData = userDoc.exists() ? userDoc.data() : {};
        
        // Ustaw informacje o użytkowniku
        userAvatar.textContent = userData.name ? userData.name.charAt(0).toUpperCase() : user.email.charAt(0).toUpperCase();
        userName.textContent = userData.name || user.email;
        
        // Załaduj umiejętności użytkownika
        await loadUserSkills();
        renderSkillTree();
      } else {
        // Użytkownik wylogowany
        currentUserId = null;
        authContainer.style.display = 'block';
        appContainer.style.display = 'none';
      }
    });

    // Załaduj umiejętności użytkownika z Firestore
    async function loadUserSkills() {
      if (!currentUserId) return;
      
      try {
        const userDoc = await getDoc(doc(db, "users", currentUserId));
        if (userDoc.exists()) {
          // Dla użytkownika ładujemy tylko poziom, nie pełne dane
          const userData = userDoc.data();
          userSkills = userData.skills || {};
        } else {
          userSkills = {};
        }
      } catch (error) {
        console.error("Błąd ładowania umiejętności:", error);
        userSkills = {};
      }
    }

    // Funkcja do renderowania drzewka
    function renderSkillTree() {
      skillTree.innerHTML = '';
      
      // Dodaj centralną oś
      const axis = document.createElement('div');
      axis.className = 'tree-axis';
      skillTree.appendChild(axis);
      
      // Renderuj każdy poziom drzewka
      SKILL_TREE.forEach((category, index) => {
        const level = document.createElement('div');
        level.className = 'tree-level';
        
        // Dodaj łącznik (oprócz pierwszego poziomu)
        if (index > 0) {
          const connector = document.createElement('div');
          connector.className = 'connector vertical-connector';
          level.appendChild(connector);
        }
        
        // Główna umiejętność kategorii
        const mainSkill = document.createElement('div');
        const mainSkillLevel = userSkills[category.id] || 3; // Domyślnie poziom 3
        mainSkill.className = `main-skill level${mainSkillLevel}`;
        mainSkill.innerHTML = `
          <div class="skill-name">${category.name}</div>
          <div class="skill-level">${category.level}</div>
        `;
        level.appendChild(mainSkill);
        
        // Renderuj gałęzie (lewa i prawa)
        category.branches.forEach(branch => {
          const branchDiv = document.createElement('div');
          branchDiv.className = `branch branch-${branch.direction}`;
          
          // Licznik umiejętności w gałęzi
          const totalSkills = branch.skills.length;
          const unlockedSkills = branch.skills.filter(skill => {
  const userLevel = userSkills[skill.id];
  if (!userLevel || userLevel === 3) return false; // poziom 3 = niewidoczny
  const reqs = skill.req || [];
  return reqs.every(r => userSkills[r] && userSkills[r] < 3); // wszystkie wymagania odblokowane
}).length;

          
          const counter = document.createElement('div');
          counter.className = 'branch-counter';
          counter.textContent = `${unlockedSkills}/${totalSkills}`;
          branchDiv.appendChild(counter);
          
          // Łącznik gałęzi
          const connector = document.createElement('div');
          connector.className = 'branch-connector';
          branchDiv.appendChild(connector);
          
          // Renderuj umiejętności w gałęzi
branch.skills.forEach(skill => {
  const userLevel = userSkills[skill.id]; // poziom użytkownika
  let skillClass = '';
  let levelText = '';

if (!userLevel || userLevel === 3) {
  // Poziom 3 lub brak → niewidoczny
  return;
}

// Sprawdź wymagania
const reqs = skill.req || [];
const unlocked = reqs.every(r => userSkills[r] && userSkills[r] < 3);

if (!unlocked) {
  skillClass = 'locked'; // szary / zablokowany
} else {
  // Jeśli użytkownik ma poziom, ustaw level, jeśli nie ma – ustaw 3 (szary)
  skillClass = `level${userLevel || 3}`; 
}

  const skillElement = document.createElement('div');
  skillElement.className = `branch-skill ${skillClass}`;
  skillElement.innerHTML = `
    <div class="skill-name">${skill.name}</div>
    <div class="skill-level">${levelText}</div>
  `;
  branchDiv.appendChild(skillElement);
});

          
          level.appendChild(branchDiv);
        });
        
        skillTree.appendChild(level);
      });
      
      // Aktualizuj postęp
      updateProgress();
    }
    
    // Aktualizuj pasek postępu
    function updateProgress() {
      const totalSkills = SKILL_TREE.reduce((total, category) => {
        return total + category.branches.reduce((branchTotal, branch) => {
          return branchTotal + branch.skills.length;
        }, 0) + 1; // +1 dla głównej umiejętności kategorii
      }, 0);
      
      // Umiejętności na poziomie 1 lub 2 są uznawane za opanowane
      const unlockedSkills = Object.values(userSkills).filter(level => level === 1 || level === 2).length;
      const progressPercent = (unlockedSkills / totalSkills) * 100;
      
      document.getElementById('progressFill').style.width = `${progressPercent}%`;
      document.getElementById('progressText').textContent = 
        `${unlockedSkills}/${totalSkills} umiejętności`;
    }
    
    // Funkcja do tłumaczenia kodów błędów Firebase
    function getAuthErrorMessage(errorCode) {
      switch (errorCode) {
        case 'auth/email-already-in-use':
          return 'Ten adres email jest już używany.';
        case 'auth/invalid-email':
          return 'Nieprawidłowy adres email.';
        case 'auth/operation-not-allowed':
          return 'Operacja nie jest dozwolona.';
        case 'auth/weak-password':
          return 'Hasło jest zbyt słabe. Użyj co najmniej 6 znaków.';
        case 'auth/user-disabled':
          return 'Konto zostało wyłączone.';
        case 'auth/user-not-found':
          return 'Nie znaleziono użytkownika.';
        case 'auth/wrong-password':
          return 'Nieprawidłowe hasło.';
        default:
          return 'Wystąpił nieznany błąd. Spróbuj ponownie.';
      }
    }
    
    // Funkcja zwracająca tekst dla poziomu umiejętności
    function getLevelText(level) {
      switch(level) {
        case 1: return "Poziom 1 (żółty)";
        case 2: return "Poziom 2 (zielony)";
        case 3: return "Poziom 3 (brak)";
        default: return "Nieokreślony poziom";
      }
    }
  </script>
</body>
</html>
